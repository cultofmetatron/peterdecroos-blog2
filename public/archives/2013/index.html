<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Archives: 2013 | Console.blog(this.thought)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="assorted writings">
<meta property="og:type" content="website">
<meta property="og:title" content="Console.blog(this.thought)">
<meta property="og:url" content="http://yoursite.com/archives/2013/">
<meta property="og:site_name" content="Console.blog(this.thought)">
<meta property="og:description" content="assorted writings">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Console.blog(this.thought)">
<meta name="twitter:description" content="assorted writings">

  
    <link rel="alternative" href="/atom.xml" title="Console.blog(this.thought)" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="http://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.min.css" type="text/css">

  <link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css">

  <link rel="stylesheet" href="/css/style.css" type="text/css">

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/">Console.blog(this.thought)</a>
    <div class="collapse navbar-collapse nav-menu">
      <ul class="nav navbar-nav">
      
        <li>
          <a href="/archives">
            <i class="fa fa-archive"></i>
            Archives
          </a>
        </li>
      
        <li>
          <a href="/categories">
            <i class="fa fa-folder"></i>
            Categories
          </a>
        </li>
      
        <li>
          <a href="/tags">
            <i class="fa fa-tags"></i>
            Tags
          </a>
        </li>
      
        <li>
          <a href="/wiki">
            <i class="fa fa-book"></i>
            Wiki
          </a>
        </li>
      
        <li>
          <a href="/about">
            <i class="fa fa-user"></i>
            About
          </a>
        </li>
      
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
          <li><a id="rss-link" href="/atom.xml" title="RSS Feed"><i class="fa fa-rss"></i></a></li>
        
      </ul>
    </div>
  </div>
</nav>
<div class="clearfix"></div>

      <div id='content' class="container">

        <div class="page-header-wrapper">
          <!--[if lt IE 9]><div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>提示:</strong>您的浏览器版本太低了,建议升级到 <strong><a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" title="IE9">IE9</a></strong> 以上,本站使用<a href="https://www.google.com/intl/zh-CN/chrome/">Chrome浏览器</a>可以获得最好的显示效果.</div><![endif]-->
          <div class="page-header">
            <h1 class="title">
          
            
              Archives
            
          
            </h1>
        </div>
      </div>
      
      <section id="main"
        
      >

  



  
    <article id="post-k2qqu11k1ce4duib" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2013/07/16/lexically-scope-like-a-boss/">How to lexically scope like a boss</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2013-07-17T05:27:00.000Z" itemprop="datePublished">Jul 16 2013</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          <p>Lexical scoping (scoping accordinng to location in source code) is probably one of<br>the most powerful features a programming language can have.<br>Today, I’m going to show you how to use lexical scoping to<br>create powerful abstractions. I will begin by introducing the concept of scope.<br>From there I will introduce a few rules for figuring out the scope of your variables<br>in javascript and then introduce the concept of a closure and how it will make you<br>positivly badass at Javascript.</p>
<h2 id="What_is_a_scope?">What is a scope?</h2>
<p>I’m assuming you have written code before. Hell, I’d dare assume you’ve written a <em>var.</em></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> variableName = <span class="string">"variable value"</span>;</div></pre></td></tr></table></figure>

<p>What does it mean to use the <em>var</em> keyword? As you may know, good javascript has you<br>prepend all your variables with var. Most will also advocate wrapping all your code in<br>an immediatly invoked function.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//this is being declared in the global scope.</span></div><div class="line"><span class="comment">//its functionally equivilant to window.foo or just plain foo</span></div><div class="line"><span class="keyword">var</span> foo = <span class="string">"super bar"</span>;</div><div class="line"></div><div class="line">(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="keyword">var</span> foo = <span class="string">"inner bar"</span>;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'this foo refers to the foo inside this function '</span>, foo);</div><div class="line">})();</div><div class="line"><span class="comment">/* I don't always create inline annonymous functions, but when I do, I</span></div><div class="line">immediatly invoke them. Live dynamically my friends &lt;3 */</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'this one will print the top level: '</span>, foo);</div></pre></td></tr></table></figure>

<p>Let’s start with this relativly simple example to begin growing some understanding.<br>Internally, the interpreter/compiler represents scopes with a tree (in simple cases, just a linked list).<br>At each node in the tree is a dictionary of values that we refer to with the variable<br>names from your source code. When we refer to foo, the interpreter (or the compiler at compile time)<br>will look for it in the most immediate scope. If it doesn’t find a value there, it will look<br>up the scope tree until it finds a node with a matching key/val and uses it for the current instruction.</p>
<p>Look at that previous code sample. If there wasn’t a <em>var foo</em> at the top of the function,<br>The interpreter would look for scope[foo] and find that it isn’t there. It would then look for an<br>entry named <em>foo</em> in the current scope’s parent. That is the global scope where<br>the variable foo exists. It refers to the value “super bar.”</p>
<h2 id="Creating_scopes_and_determining_the_current_scope’s_parent">Creating scopes and determining the current scope’s parent</h2>
<p>The rules for creating scopes differ between languages. In Javascript, we start new scopes with a<br>function.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> foo = <span class="string">"global scope"</span>;</div><div class="line"><span class="keyword">var</span> goo = <span class="string">"ber"</span>;</div><div class="line">(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="keyword">var</span> foo = <span class="string">"inner scope"</span>;</div><div class="line">  (<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">    <span class="keyword">var</span> foo = <span class="string">"super inner scope bro!"</span>;</div><div class="line">  })();</div><div class="line">})();</div></pre></td></tr></table></figure>

<p>This creates a tree with three nodes we can visually represent<br>in pseudo-coffeescript.</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">scope_chain = <span class="attribute">global</span>:</div><div class="line">                 <span class="attribute">variables</span>:</div><div class="line">                   <span class="attribute">foo</span>: <span class="string">"global scope"</span>;</div><div class="line">                   <span class="attribute">goo</span>: <span class="string">"ber"</span></div><div class="line">                 <span class="attribute">children</span>:</div><div class="line">                   <span class="attribute">inner_scope</span>:</div><div class="line">                     <span class="attribute">variables</span>:</div><div class="line">                       <span class="attribute">foo</span>: <span class="string">"inner scope"</span></div><div class="line">                     <span class="attribute">children</span>:</div><div class="line">                       <span class="attribute">super_inner_scope</span>:</div><div class="line">                         <span class="attribute">variables</span>:</div><div class="line">                           foo : <span class="string">"super inner scope bro!"</span></div></pre></td></tr></table></figure>

<p>As you can see, we have three nodes and there are variables that are available<br>at each node. If you try to access a variable, the interpreter will look up the nodes<br>until it finds an entry that matches.</p>
<p>Lets go deeper. How about we not even bother with immediatly invoking the function.<br>How would that work?</p>
<p>The simple answer is that it changes nothing. The scope chain rules are consistent. The only difference<br>is that we now have two ways variables can enter the scope. </p>
<ol>
<li>Through the scope tree, variables in parent scopes are available.</li>
<li>When variables are injected in via the function arguments which can be<br>pulled from some other scope where we invoke the function.</li>
</ol>
<p>We delay the instantiation of the scopes until they are invoked later in the program.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//scope A</span></div><div class="line"><span class="keyword">var</span> binder = <span class="function"><span class="keyword">function</span><span class="params">(st)</span> </span>{</div><div class="line">  <span class="comment">//scope B</span></div><div class="line">  <span class="keyword">var</span> state = st</div><div class="line">  <span class="keyword">return</span> {</div><div class="line">    set: <span class="function"><span class="keyword">function</span><span class="params">(newState)</span> </span>{</div><div class="line">      <span class="comment">//scope C</span></div><div class="line">      state = newState;</div><div class="line">      <span class="keyword">return</span> state;</div><div class="line">    },</div><div class="line">    get: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">      <span class="comment">//scope E</span></div><div class="line">      <span class="keyword">return</span> state;</div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>Scope order is created lexically. Each new function definition in the source (ie: text, hence the lexical)<br>is being read into the interpreter as a place to mark a new node in the scope chain on invocation.<br>I mentioned that the scope datastructure resembles a tree because both Scope C and E<br>belong to B as siblings. B in turn, belongs to A.</p>
<p>None of these functions are being invoked but the scope lookup rules are locked to A -&gt; B, B-&gt; C, B-&gt;E<br>Things get hairier when we invoke them.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//scope A</span></div><div class="line"><span class="keyword">var</span> b1 = binder(<span class="number">5</span>);</div><div class="line">b1.get();   <span class="comment">// =&gt; 5</span></div><div class="line">b1.set(<span class="number">2</span>); <span class="comment">// =&gt; 2</span></div><div class="line">b1.get(); <span class="comment">// =&gt; 2</span></div></pre></td></tr></table></figure>

<p>How on earth is this function maintaining state? The Binder, on invocation, takes the argument 5<br>and creates a scope according to the rules set forward in the source code of binder. </p>
<p>Now, 2 is in Scope B and being assigned to the variable “state” we instantiated in scope B.<br>We then return the object back. </p>
<p>The object we get back from calling binder()  has two functions and thus two child<br>scopes of B, (C, and D) which  we return back to Scope A. via the return.</p>
<p>Now it gets weird. When we call b1.get(), we invoke a function from scope A<br>which internally has a scope C who’s parent scope is scope B. It thus returns a value from scope B<br>back into scope A. Think of it like a closed loop of scopes. ie: a closure. ;)</p>
<p>This is pretty powerful. b1.set() does something similar only its injecting a variable from scope<br>A containing 2 into scope E where it is assigned to a variable in scope B and subsuquently returned.<br>B1.get(), on its next invocation returns the same value stored in that variable from the same scope<br>into scope A, the top level context.</p>
<p>We can use this to create objects with completely encapsulated states.<br>This gives us a leg up when trying to wrangle asynchrounous processes.</p>
<p>Here’s an example of a function that runs a function passed as an argument after a delay.<br>while we wait for the function to fire,<br>we can register functions to be called when the function is resolved.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//scope A</span></div><div class="line"><span class="keyword">var</span> delay = <span class="function"><span class="keyword">function</span><span class="params">(fn, args, timeout)</span> </span>{</div><div class="line">  <span class="comment">//Scope B</span></div><div class="line">  <span class="keyword">var</span> status = <span class="string">"pending"</span>; <span class="comment">//how we track what the status of the internal state is</span></div><div class="line">  <span class="keyword">var</span> result; <span class="comment">//where we are going to store the result of calling fn.</span></div><div class="line">  <span class="keyword">var</span> deps = []; <span class="comment">//where we store registered callbacks.</span></div><div class="line">  </div><div class="line">  setTimeout(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">    <span class="comment">//Scope C</span></div><div class="line">    <span class="comment">/* the scope chain from here is A -&gt; B-&gt; C</span></div><div class="line">    this simply calls teh function and allows us to pass in the</div><div class="line">    arguments as an array</div><div class="line">    */</div><div class="line">    result = fn.apply(<span class="keyword">this</span>, args); <span class="comment">//call the function</span></div><div class="line">    status = <span class="string">"done"</span>;</div><div class="line">    <span class="comment">//we run through all the functions in deps and run them one</span></div><div class="line">    <span class="comment">//by one.</span></div><div class="line">    deps.forEach(<span class="function"><span class="keyword">function</span><span class="params">(dep)</span> </span>{</div><div class="line">      <span class="comment">//Scope D</span></div><div class="line">      dep.call(<span class="keyword">this</span>, result);</div><div class="line">    });</div><div class="line">  }, timeout);</div><div class="line"></div><div class="line">  <span class="comment">//the two objects being returned have access to this scope</span></div><div class="line">  <span class="comment">//which allows us to invoke them to affect this internal </span></div><div class="line">  <span class="comment">//environmental.</span></div><div class="line">  <span class="keyword">return</span> {</div><div class="line">    done: <span class="function"><span class="keyword">function</span><span class="params">(func)</span> </span>{</div><div class="line">      <span class="comment">//Scope E</span></div><div class="line">      <span class="comment">//A -&gt; B -&gt; C</span></div><div class="line">      <span class="keyword">if</span> (status === <span class="string">"pending"</span>) {</div><div class="line">        deps.push(func);</div><div class="line">      }</div><div class="line">      <span class="keyword">if</span> (status === <span class="string">"done"</span>) {</div><div class="line">        func(result);</div><div class="line">      }</div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">var</span> promise = delay(<span class="function"><span class="keyword">function</span><span class="params">(msg)</span> </span>{</div><div class="line">  <span class="comment">//Scope F</span></div><div class="line">  <span class="keyword">return</span> msg + <span class="string">" world"</span>;</div><div class="line">}, [<span class="string">"hello"</span>], <span class="number">3000</span>);</div><div class="line"></div><div class="line"><span class="comment">//by passing this function to done, you guarantee that</span></div><div class="line"><span class="comment">//when the function passed into delay is called, it will pass</span></div><div class="line"><span class="comment">//the result into the function passed in here.</span></div><div class="line">promise.done(<span class="function"><span class="keyword">function</span><span class="params">(result)</span> </span>{</div><div class="line">  <span class="comment">//Scope G</span></div><div class="line">  <span class="built_in">console</span>.log(result);</div><div class="line">});</div><div class="line"></div><div class="line"><span class="comment">//3000 milliseconds later</span></div><div class="line"><span class="comment">//&gt; "hello world"</span></div></pre></td></tr></table></figure>

<p>Yeah its a wee bit contrived but it illustrates a point. By using a closure to wrap a<br>bunch of data into this enclosed space, we can hide away some<br>pretty sophisticated machinery to invert the responsibilty of control. Now the<br>object maintains the state of the async call to the file and we register functions<br>that it will call when the async call is resolved. This removes alot of overhead for managing<br>async functions.</p>
<p>In Node.js, we pass a callback into the third paramater  for the standard library functions. </p>
<p>What if we could apply the same principle and get an object we could pass along functions to<br>and know it will take care of running them when the file is available?</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fileObject = <span class="function"><span class="keyword">function</span><span class="params">(fileName, encoding)</span> </span>{</div><div class="line">  <span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line">  <span class="keyword">var</span> status = <span class="string">"pending"</span>;</div><div class="line">  <span class="keyword">var</span> result_data;</div><div class="line">  <span class="keyword">var</span> result_error;</div><div class="line">  <span class="keyword">var</span> deps_success = [];</div><div class="line">  <span class="keyword">var</span> deps_fail = [];</div><div class="line">  <span class="keyword">var</span> deps_always = [];</div><div class="line">  <span class="keyword">var</span> ret = {};</div><div class="line">  encod = encoding || <span class="string">'utf8'</span>;</div><div class="line"></div><div class="line">  fs.readFile(fileName, encoding ,<span class="function"><span class="keyword">function</span><span class="params">(err, data)</span> </span>{</div><div class="line">    result_data = data;</div><div class="line">    result_error = err;</div><div class="line">    <span class="keyword">if</span> (!result_error) {</div><div class="line">      deps_success.forEach(<span class="function"><span class="keyword">function</span><span class="params">(fn)</span> </span>{</div><div class="line">        fn(result_data);</div><div class="line">      });</div><div class="line">      status = <span class="string">"success"</span>;</div><div class="line">    } <span class="keyword">else</span> {</div><div class="line">      deps_fail.forEach(<span class="function"><span class="keyword">function</span><span class="params">(fn)</span> </span>{</div><div class="line">        fn(result_error);</div><div class="line">      });</div><div class="line">      status = <span class="string">"error"</span>;</div><div class="line">    }</div><div class="line">    deps_always.forEach(<span class="function"><span class="keyword">function</span><span class="params">(fn)</span> </span>{</div><div class="line">      fn();</div><div class="line">    });</div><div class="line">  });</div><div class="line">  <span class="keyword">var</span> queueFunction = <span class="function"><span class="keyword">function</span><span class="params">(list, fn)</span> </span>{</div><div class="line">    list.push(fn);</div><div class="line">  };</div><div class="line">  <span class="keyword">var</span> done = <span class="function"><span class="keyword">function</span><span class="params">(fn)</span> </span>{</div><div class="line">    <span class="keyword">if</span> (status === <span class="string">"done"</span>) {</div><div class="line">      fn(result_data);</div><div class="line">      <span class="keyword">return</span> ret;</div><div class="line">    }</div><div class="line">    <span class="keyword">if</span> (status === <span class="string">'pending'</span>) {</div><div class="line">      queueFunction(deps_success, fn);</div><div class="line">      <span class="keyword">return</span> ret;</div><div class="line">    }</div><div class="line">  };</div><div class="line">  <span class="keyword">var</span> fail = <span class="function"><span class="keyword">function</span><span class="params">(fn)</span> </span>{</div><div class="line">    <span class="keyword">if</span> (status === <span class="string">"error"</span>) {</div><div class="line">      fn(result_error);</div><div class="line">    }</div><div class="line">    <span class="keyword">if</span> (status === <span class="string">"pending"</span>) {</div><div class="line">      queueFunction(deps_fail, fn);</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> ret;</div><div class="line">  };</div><div class="line">  <span class="keyword">var</span> always = <span class="function"><span class="keyword">function</span><span class="params">(fn)</span> </span>{</div><div class="line">    <span class="keyword">if</span> (status === <span class="string">"pending"</span>) {</div><div class="line">      queueFunction(deps_always, fn);</div><div class="line">    } <span class="keyword">else</span> {</div><div class="line">      fn();</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> ret;</div><div class="line">  };</div><div class="line">  ret.done = done;</div><div class="line">  ret.fail = fail;</div><div class="line">  ret.always = always;</div><div class="line"></div><div class="line"></div><div class="line">  <span class="comment">//this exposes the status as a readonly property</span></div><div class="line">  <span class="built_in">Object</span>.defineProperty(ret, <span class="string">'status'</span>, {</div><div class="line">    get: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">      <span class="keyword">return</span> status;</div><div class="line">    },</div><div class="line">    enumerable: <span class="literal">true</span></div><div class="line">  });</div><div class="line"></div><div class="line">  <span class="keyword">return</span> ret;</div><div class="line">};</div></pre></td></tr></table></figure>

<p>Hey, that wasn’t so bad. We return an object of three functions and<br>it will take care of running the appropriate functions based on the<br>status of the object’s internal async operation when its resolved.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> newFile = fileObject(<span class="string">'./hello.txt'</span>);</div><div class="line"></div><div class="line">newFile.done(<span class="function"><span class="keyword">function</span><span class="params">(data)</span> </span>{</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'two '</span> + data);</div><div class="line">});</div><div class="line"></div><div class="line">newFile.done(<span class="function"><span class="keyword">function</span><span class="params">(data)</span> </span>{</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'one '</span> + data);</div><div class="line">});</div><div class="line"></div><div class="line">newFile.fail(<span class="function"><span class="keyword">function</span><span class="params">(err)</span> </span>{</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'the file errored out. returned: '</span> + err);</div><div class="line">});</div><div class="line"></div><div class="line">newFile.always(<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'this always gets called'</span>);</div><div class="line">});</div></pre></td></tr></table></figure>

<p>In short, lexical scoping and closures are pretty damn awesome.</p>

        
        <footer class="article-footer">
          <a data-url="http://yoursite.com/2013/07/16/lexically-scope-like-a-boss/" data-id="k2qqu11k1ce4duib" data_title="How to lexically scope like a boss"
          data_summary="Lexical scoping (scoping accordinng to location in source code) is probably one ofthe most powerful features a programming language can have.Today, I’m going t..." class="article-share-link">Share</a>
          
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript-scoping/">javascript scoping</a>
  </div>


          

        </footer>
      
    </div>
  </div>
</article>


  
    <article id="post-63vg5xrdp111fbic" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2013/07/05/thorax-is-awesome/">Thorax is Awesome</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2013-07-05T20:45:00.000Z" itemprop="datePublished">Jul 5 2013</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          <p>I like Backbone.js a lot. It’s a fantastic utlity library for building your own best of breed javascript applications. It is much more configurable than Angular or Ember - both of which make numerous assumptions about the nature of your app, which may or may not lead to frustration when working with a legacy codebase. While you certainly won’t be cranking out apps as quickly as you would in more magical frameworks, Backbone gives you enough to get started. It stays slim in features to avoid stepping on your toes. Backbone is the fixed gear bike of frontend javascript frameworks.</p>
<p>I recommend anyone new to Backbone build a few projects to learn it. In practice, I don’t recommend using Backbone alone for building out a full mvc system. Its missing a few really important features that you would have to implement yourself.</p>
<h2 id="Enter_Thorax">Enter Thorax</h2>
<p>In the world of Backbone extensions, there are three major players, Marionette, Thorax, and Chaplain. I haven’t looked at Chaplain and I found Marionette heavy for my needs. Thorax on the other hand, was a breath of fresh air. I especially loved the<a href="http://handlebarsjs.com" target="_blank" rel="external">handlebars.js</a> templates integration.</p>
<p>In the following posts, I will outline some of the major benefits of using Thorax.</p>
<ul>
<li>Out of the box render() that works</li>
<li>Child view management</li>
<li>Layout Views</li>
<li>The MVC in Backbone’s MVC</li>
</ul>
<h4 id="Out_of_the_box_render()_that_works">Out of the box render() that works</h4>
<p>Backbone.View’s default render method is a noop(), (ie: function() {}). Backbone’s author’s intend for you to write your own render function which sets its instance’s <em>el</em> property to your view’s generated representation of the model’s data. Backbone avoids adding in this feature to keep it agnostic to your templating system.</p>
<blockquote>
<p>Note: Handlebars</p>
<p>Handlebars is an html templating language for javascript.</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;h1&gt;{{ value }}&lt;/h1&gt;</div><div class="line">&lt;p&gt;</div><div class="line">  {{#if foo}}{{foobar}}{{/if}}&gt;.</div><div class="line">&lt;/p&gt;</div></pre></td></tr></table></figure>

<p>javascript</p>
<h3 id="Handlebars">Handlebars</h3>
<p>This handlebars code is fed into Handlebars.compile() which returns a template function.<br>This function is then passed a “context” object. example:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">{</div><div class="line">  value: <span class="string">"hello there"</span></div><div class="line">  foo: <span class="literal">true</span>,</div><div class="line">  foobar: <span class="string">"hello Douglas"</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>javascript</p>
<p>and generates a string of html that you can inject into the dom.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">h1</span>&gt;</span>hello there<span class="tag">&lt;/<span class="title">h1</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">p</span>&gt;</span>hello Douglas<span class="tag">&lt;/<span class="title">p</span>&gt;</span></div></pre></td></tr></table></figure>

<p>Since Thorax makes the decision of using Handlebars, it can give us a default render() method that’s usable rather than a noop(). Thorax.View.render() constucts a context object containing all of the <em>properties</em> of the view instance and the attributes of the model which is passed into the Handlebars template function so that it’s available in the rendered view.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//render function, this is what a Thorax render does,</span></div><div class="line"><span class="comment">// *this* resolves to the thorax instance</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> render = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="comment">//get the attributes of the property</span></div><div class="line">  <span class="keyword">var</span> viewProperties = {};</div><div class="line">  <span class="keyword">for</span> ( <span class="keyword">var</span> property <span class="keyword">in</span> <span class="keyword">this</span>) {</div><div class="line">    viewProperties[property] = <span class="keyword">this</span>[property];</div><div class="line">  };</div><div class="line">  <span class="comment">//underscore.js's extend</span></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.model) {</div><div class="line">    viewProperties = _.extend(viewProperties, <span class="keyword">this</span>.model.attributes);</div><div class="line">  };</div><div class="line">  <span class="keyword">this</span>.$el.html(<span class="keyword">this</span>.template(viewProperties));</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>By default, properties of the view insance get passed to the template but not the functions. What if we want to overide this?</p>
<p>In the past, I would write view helpers in order to render attributes that required computation. There’s a more elegant way using the<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="external">defineProperty</a> function.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">var peter = new Thorax.Model({</div><div class="line">  firstName: 'Peter',</div><div class="line">  lastName:  'de Croos',</div><div class="line">  githubHandle: 'Cultofmetatron'</div><div class="line">});</div><div class="line"></div><div class="line">var PersonView = Thorax.View.extend({</div><div class="line">  template:</div><div class="line">    Handlebars.compile("we can call</div><div class="line">             {{firstName}},</div><div class="line">             {{lastName}} and</div><div class="line">             {{fullName}}"),</div><div class="line">  initialize: function() {</div><div class="line">    Object.defineProperty(this, 'fullName', {</div><div class="line">      get: function() {</div><div class="line">        return this.model.get('firstName') + ' ' +</div><div class="line">        this.model.get('lastName');</div><div class="line">      },</div><div class="line">      enumerable: true // see note below</div><div class="line">    });</div><div class="line">  }</div><div class="line">});</div><div class="line"></div><div class="line">var peterView = new PersonView({</div><div class="line">  model: peter</div><div class="line">});</div></pre></td></tr></table></figure>

<blockquote>
<p><em>Technical note:</em> By default, properties defined by <em>defineProperty</em> are not enumerable.</p>
<p>IE: They won’t show up when you do the <em>for (property in this) {}</em>. Because thats how thorax’s render view gets at the attributes, it won’t show up in the template either. Luckily that is easy enough to fix by specifying the option<em>enumerable:true</em></p>
</blockquote>
<h4 id="Child_view_management">Child view management</h4>
<p>Backbone does nothing to address embedded views. It expects you to write your own logic for handling child views in the render function. As you can imagine, it is kind of a pain. It sounds simple enough in theory, but in practice it means that you have to write code to check if a parent view is being removed and recursivly have it descend into all it child views to undelegate events from the dom. This is a major potential source of javascript memory leaks. Thorax provides some great helper functions for this. It just wins.</p>
<p>Thorax.Views can be embedded in another view simply by adding the subview as a property.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> blogModel = Thorax.Model({</div><div class="line">  name: <span class="string">'console.log(this.thought)'</span>,</div><div class="line">  post: <span class="keyword">new</span> Thorax.Model({</div><div class="line">    title: <span class="string">"Thorax is awesome"</span>,</div><div class="line">    content: <span class="string">"maximum callstack exeeded"</span></div><div class="line">  })</div><div class="line">});</div><div class="line"></div><div class="line"><span class="keyword">var</span> PostView = Thorax.View.extend({</div><div class="line">  template: Handlebars.compile(<span class="string">'&lt;h2&gt;{{title}}&lt;/h2&gt;&lt;p&gt;{{content}}&lt;/p&gt;'</span>)</div><div class="line">});</div><div class="line"></div><div class="line"><span class="keyword">var</span> blogView = <span class="keyword">new</span> BlogView({</div><div class="line">  template: Handlebars.compile(<span class="string">"&lt;h1&gt;{{name}}&lt;/h1&gt;{{view postView}}"</span>),</div><div class="line">  model: blogModel,</div><div class="line">  postView: <span class="keyword">new</span> PostView({</div><div class="line">    model: <span class="keyword">this</span>.model.get(<span class="string">'post'</span>)</div><div class="line">  })</div><div class="line">});</div></pre></td></tr></table></figure>

<p>As you can see, it was as easy as embedding  {{view postView }} inside the template and Thorax takes of care of yielding control of that region to the child view.</p>
<h4 id="Layout_Views">Layout Views</h4>
<p>Let me just say that layout views are really awesome. A layout view is a view with the sole purpose being a container which can hold whatever view/model combo fits the current context.</p>
<h5 id="The_MVC_in_Backbone’s_MVC">The MVC in Backbone’s MVC</h5>
<p>There’s a Backbone.Model and a Backbone.View but where is Backbone.Controller? (hint: there isn’t one)</p>
<p>Currently Marrionette augments Backbone with a Controller object but Thorax does nothing of the sort. I guess the real question is, where does a controller fit?</p>
<p>Philosphically, MVC stands for a seperation of concerns between</p>
<ol>
<li>Models: the data containing the application logic we are modelling on the computer</li>
<li>Views: Objects that manage the presentation of the models. This includes binding event handlers and rerendering when the underlying model(s) change.</li>
<li>Controllers: Objects that take care of managing what view and model are relevant.</li>
</ol>
<p>In the Rails world, the architectural philosphy revolves around the concept of skinny controller/fat Model. The brunt of the code for manipulating the models should be inside the instance methods in the models themeselves and the controller interacts with it through an api.</p>
<p>When we really get down to it, controllers perform a few functions.</p>
<ol>
<li>Watch out for some event that should trigger a change in view and/or model.</li>
<li>Manage the creation of new view instances to represent new or altered models.</li>
<li>Render html and insert it into the DOM.</li>
</ol>
<p>Our controller will handle only the details of getting the proper model and binding it to a view so that it can be rendered.</p>
<p>Lets create a function PostController that does nothing more than lookup a model by its id and creates a post view.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> postController = <span class="function"><span class="keyword">function</span><span class="params">(postId)</span> </span>{</div><div class="line">  <span class="comment">//for info on Thorax.Views, Thorax.Models and Thorax.Collections,</span></div><div class="line">  <span class="comment">//see the note below</span></div><div class="line">  <span class="keyword">var</span> postView = <span class="keyword">new</span> Thorax.Views.FullPagePostView({</div><div class="line">    model: Thorax.Collections.posts.get(postId)</div><div class="line">  });</div><div class="line">  <span class="keyword">return</span> postView;</div><div class="line">}</div></pre></td></tr></table></figure>

<blockquote>
<p><strong>Note</strong> About Thorax Registries</p>
<p>Thorax provides a Registry: a series of hashes where you can store the Constructor Functions for your extended models and views.</p>
<p>For more information visit <a href="http://thoraxjs.org/api.html#registry" target="_blank" rel="external">The throax docs</a></p>
</blockquote>
<p>Now we have a basic controller that handles cases 2 and 3 of our list. We still need to take care of figuring out how we want to determine when this controller gets called. In the projects I have worked on, I’ve solved this problem using the router.</p>
<p>Thorax does nothing special with the router so we will use Backbone.Router as is. It will manage one Layout view, a special Thorax view made for holding other views.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//router.js var layoutContainer;</span></div><div class="line"><span class="keyword">var</span> callController = <span class="function"><span class="keyword">function</span><span class="params">(controller)</span> </span>{</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">    <span class="comment">//arguments is used to shift responsibilty of knowing the</span></div><div class="line">    <span class="comment">//amount of paramaters to the controller</span></div><div class="line">    <span class="keyword">var</span> view = controller.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">    layoutContainer.setView(view);</div><div class="line">  };</div><div class="line">};</div></pre></td></tr></table></figure>

<p>The function <em>callController</em> takes a controller, passes along the arguments given to it by the router and takes care of the boiler plate of creating a view and setting it into the container.<em>layoutContainer.setView()</em> takes care of undelegating events of all elements attached to the previous view (if there was a previous view) as it swaps in the html of the new view.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//continued from above</span></div><div class="line"><span class="keyword">var</span> Router = Backbone.Router.extend({</div><div class="line">  initialize: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">    layoutContainer = <span class="keyword">new</span> Thorax.LayoutView({ template: <span class="string">'#AppLayout'</span> });</div><div class="line">    <span class="comment">/* this is the point in the html where our container will be injected in.</span></div><div class="line">    from here on out, the router and controller system will take care of</div><div class="line">    swappng out application views within this container. */</div><div class="line">    layoutContainer.appendTo(<span class="string">'#entry-point'</span>);</div><div class="line">    $(<span class="built_in">document</span>).trigger(<span class="string">'popstate'</span>);</div><div class="line">  },</div><div class="line">  routes: { <span class="string">'posts/:postId'</span>: <span class="string">'postRoute'</span> },</div><div class="line">  postRoute: callController(postController)</div><div class="line">});</div></pre></td></tr></table></figure>

<p>This is a pretty straight forward setup with one possible new thing. So you probably noticed the <em>$(document).trigger(‘popstate’)</em>. In standard backbone, the application instance Router has a method <em>navigate()</em> usually called by</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">router.navigate(<span class="string">'path/to/route'</span>, { trigger: <span class="literal">true</span> });</div></pre></td></tr></table></figure>

<p>The trigger true is needed by backbone for the router to trigger any associated actions. The browser by default writes to history when the document recieves the<a href="https://developer.mozilla.org/en-US/docs/Web/Reference/Events/popstate" target="_blank" rel="external">popstate</a> event. The browser triggers popstate automatically when you enter a page or hit the backwards or forward buttons. When you click back, the new url will load and the router which is listening for the popstate event on ‘document’ will perform the behavior associated with that url.</p>
<p>By having the <em>$(document).trigger(‘popstate’)</em> at the end of the initialization, we guarantee that once the router is finished initializing, it will read in the url and trigger the appropriate context for the app for the url. This is great if we want multiple url entry points through which the user enters the app. The user gets the same javascript no matter what url of the website they visit. The app takes care of loading the right content based on the url.</p>
<p>Finally, the template option that was passed into the instantiation of layoutView is optional. By default, Thorax wraps the layout in a div tag. We can customize the layoutView by giving it a template and using the layout-element helper in that template.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">id</span>=<span class="value">"appLayout"</span> <span class="attribute">type</span>=<span class="value">"handlebars/template"</span>&gt;</span><span class="javascript"></span></div><div class="line"></div><div class="line">  {{layout-element tag=<span class="string">"div"</span> id=<span class="string">"currentContext"</span> <span class="keyword">class</span>=<span class="string">"container"</span>}}</div><div class="line"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div></pre></td></tr></table></figure>


        
        <footer class="article-footer">
          <a data-url="http://yoursite.com/2013/07/05/thorax-is-awesome/" data-id="63vg5xrdp111fbic" data_title="Thorax is Awesome"
          data_summary="I like Backbone.js a lot. It’s a fantastic utlity library for building your own best of breed javascript applications. It is much more configurable than Angula..." class="article-share-link">Share</a>
          
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/backbone-thorax-defineProperty/">backbone thorax defineProperty</a>
  </div>


          

        </footer>
      
    </div>
  </div>
</article>


  
    <article id="post-eh1djz3mtedxivvf" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2013/06/02/backbone-primer/">Backbone, a short primer - Part 1: Models and Events</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2013-06-02T21:42:00.000Z" itemprop="datePublished">Jun 2 2013</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          <p>Its been a few months since I’ve started using backbone on my personal projects. Its a great library for rolling out MVC structure into your application but the learning curve is pretty brutal.</p>
<p>The first step to really understanding the backbone.js framework.</p>
<h3 id="There_is_no_framework">There is no framework</h3>
<p>Seriously, get it out of your head entirely that backbone is a frameowrk. Its far too minimal. Backbone is more like a toolkit library for contructing MVC frameworks.</p>
<p>Backbone provides the following objects</p>
<ul>
<li><a href="http://backbonejs.org/#Model" target="_blank" rel="external">Backbone.Model</a></li>
<li><a href="http://backbonejs.org/#Collection" target="_blank" rel="external">Backbone.Collection</a></li>
<li><a href="http://backbonejs.org/#View" target="_blank" rel="external">Backbone.View</a></li>
<li><a href="http://backbonejs.org/#Router" target="_blank" rel="external">Backbone.Router</a></li>
</ul>
<p>The real key is how we use it. Like Chess, it can be learned very quickly. the problem is that you also need to understand the tactics and strategies. The offical docs leave a lot to the imagination and the examples are lackluster at best if they exist at all.</p>
<h3 id="Backbone-Model">Backbone.Model</h3>
<p>Backbone.Model is a storage container where we can add and remove items via <em>set</em> and <em>get</em> attributes.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> newModel = <span class="keyword">new</span> Backbone.Model();</div><div class="line">newModel.set(<span class="string">'foo'</span>, bar);</div><div class="line">newModel.get(<span class="string">'foo'</span>) <span class="comment">// =&gt; 'bar'</span></div></pre></td></tr></table></figure>

<p>You may be wondering why you don’t use <em>newModel.foo = ‘bar’?</em> The real power in backbone is in the events that models can fire. By having you access the model’s attributes via<em>set</em> and <em>get</em>, you ensure that the associated callbacks get fired everytime an attribute is changed.</p>
<p>For example, in a View containing a Model, when we change an attribute on the model via the setter and getter methods. A callback automatically makes the model emit a ‘change’ event which we can set the view to listen to and trigger a rerender.</p>
<h4 id="Extending_Backbone-Model">Extending Backbone.Model</h4>
<p>Backbone.Model is inherited using extend. This is also where we add methods that may be specific to our particular subclass of Backbone.Model. For instance, lets create a Comments model which may contain a username, content, rating and timestamp.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Comment = Backbone.Model.extend({</div><div class="line">  <span class="comment">//defaults are self explanatory</span></div><div class="line">  defaults: {</div><div class="line">    rating: <span class="number">0</span>,</div><div class="line">  },</div><div class="line">  <span class="comment">/*</span></div><div class="line">   * initialize runs whenever new is called, it takes care of</div><div class="line">   * setting up __super in the inheritance chain</div><div class="line">   * there is also 'constructor' which overides the contructor entirely</div><div class="line">   * leaving you to manually impliment the prototype chaining.</div><div class="line">   * ie: only use constructor if you know what you are doing.</div><div class="line">  */</div><div class="line">  initialize: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">    <span class="keyword">this</span>.set(<span class="string">'owner'</span>, getCurrentUser());</div><div class="line">    <span class="keyword">this</span>.set(<span class="string">'timestamp'</span>, <span class="keyword">new</span> <span class="built_in">Date</span>());</div><div class="line">  },</div><div class="line">  upvote: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">    <span class="keyword">this</span>.set(<span class="string">'rating'</span>, <span class="keyword">this</span>.get(<span class="string">'rating'</span>)++);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">  }</div><div class="line">});</div><div class="line"></div><div class="line"><span class="comment">/* now we initialize the model passing in values in an object. */</span></div><div class="line">  <span class="keyword">var</span> newComment = <span class="keyword">new</span> Comment({</div><div class="line">  content: <span class="string">"backbone needs a library for reactive databindings"</span>,</div><div class="line">});</div><div class="line"></div><div class="line">newComment.upvote().get(<span class="string">'rating'</span>); <span class="comment">// =&gt; 1</span></div></pre></td></tr></table></figure>

<p>Here we’ve set up a basic backbone model for setting representing a comment. In defaults, we put in an object of default attributes. You may be wondering why I set up the owner and timestamp attributes in <em>initialize.</em></p>
<p>The defaults object and anything inside it is evaluated into a static object inside the extend function call. Thus, if you were to try this</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Comment = Backbone.Model.extend({</div><div class="line">   <span class="comment">//defaults are self explanatory</span></div><div class="line">   defaults: {</div><div class="line">     rating    : <span class="number">0</span>,</div><div class="line">     owner     : getCurrentUser();</div><div class="line">     timestamp : (<span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{ <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>() })();</div><div class="line">   }</div><div class="line">   ...</div><div class="line">})</div></pre></td></tr></table></figure>

<p>you would find that every instance will have the same timestamp. To get around this, I have the functionality for those defaults set to run in initialize.</p>
<h4 id="Backbone-Model_events">Backbone.Model events</h4>
<p>Backbone models should only broadcast events in order to notify things that contain it. A model itself can contain another model as an attribute.</p>
<p>Backbone.Model’s ‘change’ event fires when it detects a change in the value of the attribute. If the value is a model, then a change in that model’s attributes won’t change the reference to the model. Unlike the dom, we have to explicitly set up our own event bubbling.</p>
<p>To set up your own event delegation, you have to set up a listener in the parent model to listen for events in the attribute model.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> CommentHolder = Backbone.Model.extend({</div><div class="line">  initialize: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">    <span class="comment">/* We set up event listeners here</span></div><div class="line">      the first argument is message being fired</div><div class="line">      the second is the function to be invoked</div><div class="line">      the third is the context for function to be called in</div><div class="line">    */</div><div class="line">    <span class="keyword">this</span>.get(<span class="string">'comment'</span>).on(<span class="string">'all'</span>, <span class="keyword">this</span>.bubble, <span class="keyword">this</span>);</div><div class="line">  },</div><div class="line">  bubble: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">    <span class="comment">// apply is used to propegate all possible arguments</span></div><div class="line">    <span class="comment">// that can be coming form multiple events.</span></div><div class="line">    <span class="keyword">this</span>.trigger.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>); <span class="comment">//trigger is a backbone function</span></div><div class="line">  }</div><div class="line">})</div></pre></td></tr></table></figure>

<p><a href="http://backbonejs.org/#Events-catalog" target="_blank" rel="external">‘all’</a> is a backbone defined catch all event that sends along the name of the event as the first argument. The model will listen to its comment and broadcast any messages it recieves to any who would hear.</p>

        
        <footer class="article-footer">
          <a data-url="http://yoursite.com/2013/06/02/backbone-primer/" data-id="eh1djz3mtedxivvf" data_title="Backbone, a short primer - Part 1: Models and Events"
          data_summary="Its been a few months since I’ve started using backbone on my personal projects. Its a great library for rolling out MVC structure into your application but th..." class="article-share-link">Share</a>
          
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript-backbone-js-models-mvc/">javascript backbone.js models mvc</a>
  </div>


          

        </footer>
      
    </div>
  </div>
</article>


  
    <article id="post-nvpa95dh1hvkk2hu" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2013/04/12/processes-in-node-pid-to-kill/">processes in node Part 2: pid to kill</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2013-04-12T17:22:00.000Z" itemprop="datePublished">Apr 12 2013</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          <p>Internally within node, every object has an id that V8 uses to keep track of these object. In the same way, when we invoke a request to the operating system to create a process, the operating system loads the program into memory and assigns it an id which can be used to track the running program throughout its life cycle.</p>
<p>The id this process is assigned is called a pid and it can be accessed from within node via process</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> pid = process.pid; <span class="built_in">console</span>.log(pid); </div></pre></td></tr></table></figure>

<p><em>Fun fact</em>: if you open another terminal and type “kill -9 (process pid).” You will have effectivly terminated the process in the other window by having the operating system directly deliver a kill switch to your running node instance.</p>
<p>The process module is global so we don’t need to require it. It gives us alot of information about the running node instance that we can use in our programs.</p>
<p>Example operations include</p>
<ul>
<li>exiting the program</li>
<li>changing directories/ getting directory information</li>
<li>getting the name of the directory of the start script</li>
<li>retrieving argumenst passed into the command line invocation of the script</li>
</ul>
<h4 id="process_events">process events</h4>
<p>specific to node.js is the ability to bind to occur at process events.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> runOnExit = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line"> <span class="built_in">console</span>.log(<span class="string">'...exiting'</span>);</div><div class="line">};</div><div class="line"></div><div class="line">process.on(<span class="string">'exit'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="comment">/* its important that you do not invoke</span></div><div class="line">  * any asynchronous functions in here</div><div class="line">  */</div><div class="line">  runOnExit();</div><div class="line">});</div></pre></td></tr></table></figure>

<p>In the case of exit, the event loop terminates. The documentation specifically mentions events scheduled with setTimeout. Its important to note that this applies to all asych events as they all operate on setTimeout underneath.</p>
<p><em>Consequently, if you need to write some pertinent information to the disc, Be sure to use writeFileSync!!</em></p>
<h4 id="process-kill">process.kill</h4>
<p>TLDR: Processes can send signals to each other and recieve signals from the ernal</p>
<p>Signals can be compared to events and event listeners in javascript. kill()’s name is unfortunate since kill is really a function for sending messages to other processes as OS signals. You will use this function to tell other processes to go kill themeselves most of the time.</p>
<p>This isn’t limited to node processes speaking amongst themeselves. Ever run node and then exit it using <em>ctrl-c.</em></p>
<p>For a great list of standard unix signals, check out this<a href="http://people.cs.pitt.edu/~alanjawi/cs449/code/shell/UnixSignals.htm" target="_blank" rel="external">Awesome Chart</a></p>
<p>We can orginaize them according to their default behaviors.</p>
<ul>
<li>kill requests/reports</li>
<li>error reporting</li>
<li>device access notification</li>
<li>coordinating io</li>
</ul>
<p>We can overide the default behaviors for some of these signals.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="string">"to delete =&gt; kill -9 "</span> +process.pid);</div><div class="line"><span class="built_in">console</span>.log(<span class="string">"\n\n this is a a reinforced program, it will not easily die"</span>);</div><div class="line"></div><div class="line"><span class="comment">/* SIGINT is sent to your process when you type in CTR-C.</span></div><div class="line">   the operating system intercepts this command and relays</div><div class="line">   it to your node instance. node's default response is to exit.</div><div class="line"> */</div><div class="line">process.on(<span class="string">'SIGINT'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'you tried to press CTRL-C, go ahead, try again'</span>);</div><div class="line">});</div><div class="line"></div><div class="line">process.on(<span class="string">'SIGTSTP'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'LOL, nope - CTRL-Z won\'t save you!! either'</span>);</div><div class="line">});</div><div class="line"><span class="comment">//this keeps the program from exiting</span></div><div class="line"><span class="keyword">var</span> mainLoop = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{ setTimeout(mainLoop, <span class="number">0</span>); };</div><div class="line">mainLoop();</div></pre></td></tr></table></figure>

<p>A more realistic scenario would be a situation in which you need to write some files to the disk before kicking off the exit procedures.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">process.on(<span class="string">'SIGINT'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'writing to disk'</span>);</div><div class="line">  saveData();</div><div class="line">  <span class="keyword">return</span> process.exit(<span class="number">0</span>);</div><div class="line">});</div></pre></td></tr></table></figure>

<p>You cannot overwrite the kill -9 signal. This is why certain programs can become corrupted when you kill-9 them. they are not given a chance to save state.</p>
<p>For more information about signals, I found these two guides to be excellent.</p>
<ul>
<li><a href="http://www.workingwithunixprocesses.com/?utm_source=jstorimer.com&amp;utm_medium=blog&amp;utm_campaign=bookspage" target="_blank" rel="external">Working with Unix Processes</a></li>
<li><a href="http://www.amazon.com/The-Linux-Programming-Interface-Handbook/dp/1593272200/ref=sr_1_1?ie=UTF8&amp;qid=1366589402&amp;sr=8-1&amp;keywords=linux+programming+interface" target="_blank" rel="external">The linux Programming Interface</a></li>
</ul>
<p>Signals are a primitive pipeline for relaying messages. If you are looking to build some form of complex communication pipeline between individual processes, you are better off doing so over tcp. There are frameworks that facilitate this such as <a href="http://www.zeromq.org/" target="_blank" rel="external">zeromq</a> with an excellent <a href="https://github.com/JustinTulloss/zeromq.node" target="_blank" rel="external">node binding available</a>.</p>

        
        <footer class="article-footer">
          <a data-url="http://yoursite.com/2013/04/12/processes-in-node-pid-to-kill/" data-id="nvpa95dh1hvkk2hu" data_title="processes in node Part 2: pid to kill"
          data_summary="Internally within node, every object has an id that V8 uses to keep track of these object. In the same way, when we invoke a request to the operating system to ..." class="article-share-link">Share</a>
          
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/node-process-fork/">node process fork</a>
  </div>


          

        </footer>
      
    </div>
  </div>
</article>


  
    <article id="post-7bk36d0z8g1c8sp6" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2013/04/11/processes-in-node-introduction/">Proceses in node part 1: introduction to processes</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2013-04-11T21:26:00.000Z" itemprop="datePublished">Apr 11 2013</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          <p>As a language made to exist within the browser, javascript did not originally<br>come with a way to do process process related tasks. Until Chrome, browser based<br>javascript was running within the same process as the browser.</p>
<p>In Chrome, every tab runs in its own process. Consequently, your javascript on any given<br>page runs in its own process. Now that node has brought javascript into the server and far from<br>the restrictive confines of the browser, We can do intersting things like run other programs from node.</p>
<h3 id="What_is_a_process?">What is a process?</h3>
<p>Much like the relationship between a Constructor function + its prototypye and the<br>object created by invoking the <em>new</em> keyword, a process is an operating system level invocation<br>of some program.</p>
<h3 id="Process_vs_Program_-_a_very_high_level_overview">Process vs Program - a very high level overview</h3>
<p>Imagine the hardrive that powers your computer. Stored on it is a long range of numbers.<br>For all practical purposes, we can think of it as a long serial stream of bits layed out. with information<br>encoded on them. At some magical location is the boot sector. When the computer first starts running,<br>it startsloading binary data from the hardrive into the RAM and then loads this data into the cpu.<br>At this point we load the master process which we call the operating system kernal.<br>The kernal then takes care of managing other processes in the system.</p>
<p>At this point, we get to your program. If we were doing this in <em>C</em>, the the compiler would compile your<br>source code into binary code which follows an executable format. The actual encoding of this binary instruction<br>stream varies across cpu architectures and operating systems. They do happen to share some<br>common characteristics. Most of this information is located in the header of the file as information that tells<br>the operating system that this code is executable and information on how it is to be run.</p>
<h5 id="Entry_Point_Address">Entry Point Address</h5>
<p>At some point in the binary stream of bytes that is your program, there exists the first instruction that<br>needs to be loaded into the cpu. The Operating System loads this address into memory and queues it up<br>for running into the cpu.</p>
<h5 id="Data">Data</h5>
<p>Constants in the process are stored in the data stream in some area where they can be accessed by the<br>Process as it runs. This includes mathematical constants such as Math.PI or string error messages.</p>
<h5 id="Symbol_and_Lookup_Tables-">Symbol and Lookup Tables.</h5>
<p>To properly explain symbol and lookup table, I need to elaborate on what is going on at the<br>instruction level on your computer. Basicly, it stores the locations of all the variables and function<br>entry points. in memory.</p>
<h3 id="Processes_verses_threads">Processes verses threads</h3>
<p>The simple $2 answer is that processes have their own copy of all the data and symbol information. In some languages, multiple threads exist within a process and all share the same data. more importantly, you cannot create threads in node.</p>
<h3 id="Processes_and_node">Processes and node</h3>
<p>For us nodesters, the picture gets a bit more complicated. The computer loads up the program instructions<br>we affectionatly know as node and loads it into memory. From there, the node program as a static set of<br>bits on the hardrive becomes an almost living thing that loads your javascript into memory and run it!</p>
<p>To clarify, the process running when you run your node program is an instance of the node program. You can<br>have several node instances running in memory. They can even all serve http requests as long as they are<br>not trying to bind to the same port.</p>
<p>Understanding processes is incredibly useful. In Ruby, processes forking is used heavily in the design of<br><a href="http://unicorn.bogomips.org/" target="_blank" rel="external">unicorn</a>. Services like nodejitsu and heroku utilize smart people who understand<br>how processes work to architect systems that run and manage your code on the cloud. More importantly, node code<br>can only run on one processor at any given time but by using features such as <em>fork</em>, you can set up a master<br>node process that delegates tasks to subprocesses it spawns yourself. Since node processes are so<br>lightweight, you could concievably run hundreds on your system at the same time.</p>

        
        <footer class="article-footer">
          <a data-url="http://yoursite.com/2013/04/11/processes-in-node-introduction/" data-id="7bk36d0z8g1c8sp6" data_title="Proceses in node part 1: introduction to processes"
          data_summary="As a language made to exist within the browser, javascript did not originallycome with a way to do process process related tasks. Until Chrome, browser basedjav..." class="article-share-link">Share</a>
          
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/node-javascript-systems-process/">node javascript systems process</a>
  </div>


          

        </footer>
      
    </div>
  </div>
</article>


  
    <article id="post-nd6jnv80vtzk5f5r" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2013/03/31/on-this-protototypes-and-dunderheads/">On this, protototypes, and dunderheads</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2013-04-01T06:34:00.000Z" itemprop="datePublished">Mar 31 2013</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          <p>Of all the stranger than fiction things I have seen, I can’t say I have experienced as blatant a miscarriage of conceptual understanding as I have with javascript’s object system. (Ok, I might be exagerating just a little…)</p>
<p>Javascript is an interesting language. It is quite powerful when paired with appropriate libraries like <a href="http://underscorejs.org/" target="_blank" rel="external">underscore</a>. Its prototypical inheritence model is a mindblowlingly powerful reductionist critique of classical inheritance. In the right hands, functions become lego pieces that can be glued onto objects in staggeringly flexible ways.</p>
<h3 id="On_“this”">On “this”</h3>
<p>Lets take an object</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myObject = {};</div></pre></td></tr></table></figure>

<p>This is a basic object. It is also a hash.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//We can access it via dot notation or hash notation</span></div><div class="line">myObject[<span class="string">'jackson'</span>] = <span class="number">5</span>;</div><div class="line"><span class="number">5</span> + myObject[<span class="string">'jackson'</span>]; <span class="comment">// =&gt; 10;</span></div><div class="line"><span class="number">5</span> + myObject.jackson;    <span class="comment">// =&gt; 10;</span></div><div class="line"></div><div class="line"><span class="comment">//we can store strings, numbers, other objects and very importantly,</span></div><div class="line"><span class="comment">// other functions!</span></div><div class="line">myObject.title = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  <span class="keyword">return</span> <span class="string">"this is the Jackson "</span> + <span class="keyword">this</span>.jackson;</div><div class="line">}</div><div class="line"></div><div class="line">myObject.title() <span class="comment">// =&gt; "this is the Jackson 5";</span></div></pre></td></tr></table></figure>

<p>If you are currently a javascript programmer, you’ve probably seen code like this. In langages like Java, or c, Functions are simply routines that operate on code. they are static. Once they exist, they exist in only one context. The Java version of <em>‘this’</em> refers to the instance of the instantiated object.</p>
<p>Functions in javascript are “First Class.” This is a really important distinction to make because it enables all of the most powerful code reuse techniques. A function can exist beyond an object. It can be made an instance function a several different objects. In practice, it means we can assign functions to variables and pass it into functions as arguments. We can even return functions from other functions.</p>
<p>Put more succinctly…</p>
<p>We can create a function which performs operations related to an abstract “this” attribute without knowing what “this” is going to be till we hook up a context to it when its called.</p>
<p>It is important to discuss the notion of call time. Languages where functions are not first class do not have a call time.</p>
<p>Lets take a cannonical example in Java.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleClass</span> </span>{</div><div class="line"></div><div class="line">  <span class="keyword">public</span> <span class="keyword">int</span> foo;</div><div class="line"></div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(String[] args) {</div><div class="line">      System.out.println(<span class="string">"Clojure is way more fun"</span>);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keyword">public</span> <span class="title">ExampleClass</span>(<span class="keyword">int</span> foo) {</div><div class="line">      <span class="comment">// initialize code goes here</span></div><div class="line">      <span class="keyword">this</span>.foo = foo;</div><div class="line">  }</div><div class="line">  <span class="keyword">public</span> <span class="title">getFoo</span>() {</div><div class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.foo;</div><div class="line">  }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>Java functions are not first class. The <em>‘this’</em> refers only to the instantiated instance of this class. If I instantiate this class and call the function, I will get the class variable “foo” of the instance.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ExampleClass exampleClass = <span class="keyword">new</span> ExampleClass(<span class="number">5</span>); <span class="comment">// Java is ridiculous!!! exampleClass.getFoo(); // =&gt; 5</span></div><div class="line"></div><div class="line"><span class="comment">// this results in an error because there is no public variable getFoo exampleClass.getFoo;</span></div></pre></td></tr></table></figure>

<p>Because Java’s functions are not first class, there is no notion of this function being referred to unless its being specifically called. Javascript’s functions are dfferent. I can declare a javascript function and bind it to several objects.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> getFoo = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{ <span class="keyword">return</span> <span class="keyword">this</span>.foo; };</div><div class="line"></div><div class="line"><span class="keyword">var</span> first = { foo:<span class="number">1</span> }; first.getFoo = getFoo;</div><div class="line"></div><div class="line"><span class="keyword">var</span> second = { foo: <span class="number">2</span> }; second.getFoo = getFoo;</div><div class="line"></div><div class="line"><span class="keyword">var</span> third = {foo:<span class="number">3</span>}; third.theNameIsIrrelevant= getFoo;</div><div class="line"></div><div class="line">first.getFoo() <span class="comment">// =&gt; 1 second.getFoo() // =&gt; 2 third.theNameIsIrrelevant() // =&gt; 3</span></div></pre></td></tr></table></figure>

<p>This code in javascript works because javascript functions are variables that can be assigned and passed around like a company pen. (thats about as work safe a metaphor as I could come up with. sorry…) The only large difference between functions and other javascript types is that functions can be <em>called.</em></p>
<p>Call time is the point where the javascript function is executed. If it contains a <em>‘this’</em> inside it. That keyword then resolves to whatever object that function is being called upon. If there is no object, <em>‘this’</em> resolves to the global object. In Browsers, the global object is <em>window.</em></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"> <span class="built_in">window</span>.foo = <span class="string">"ramalamadingdong"</span>;</div><div class="line"></div><div class="line">getFoo(); <span class="comment">// =&gt; "ramalamadingdong"</span></div></pre></td></tr></table></figure>

<h3 id="on_proto_and_prototype">on <strong>proto</strong> and prototype</h3>
<p><em>new</em> is a feature of javascript that changes the context of <em>‘this’</em> in a constructor function. when new is called on a constructor function being called, <em>new</em> becomes an object that is being modified and eventually returned. It will delegate function calls it cannot respond to to whatever the function’s prototype attribute is. IE: functions in javasript are objects.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> dundar = { gummy:<span class="string">'bear'</span> }</div><div class="line"></div><div class="line"><span class="keyword">var</span> ContructorFunction = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{ <span class="comment">// at this point this == {}; this.foo = "bar"</span></div><div class="line"></div><div class="line"><span class="comment">// "return this" is implicit</span></div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line">ContructorFunction.prototype = dundar;</div><div class="line"></div><div class="line">newObject = <span class="keyword">new</span> ContructorFunction();</div><div class="line"></div><div class="line">newObject.gummy; <span class="comment">// =&gt; 'bear' newObject.foo; // =&gt; 'bar'</span></div></pre></td></tr></table></figure>

<h3 id="The_proto_Attribute">The <strong>proto</strong> Attribute</h3>
<p>Javascript’s prototype delegation is setup such that if an attribute is accessed on an object and the object does not have that attribute. It will defer that request to the object set as its <strong>proto</strong>. The <strong>proto</strong> is determined by the constructor function’s <em>prototype</em> attribute.</p>
<h4 id="This_begs_the_question?_why_doesn’t_this_work?">This begs the question? why doesn’t this work?</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> dundar = { gummy:<span class="string">'bear'</span> }</div><div class="line"></div><div class="line">newObject = { foo: <span class="string">'bar'</span> }; newObject.**proto** = dundar;</div></pre></td></tr></table></figure>

<h4 id="Actually_it_DOES,_But_only_in_V8_-_ie:_chrome_and_node-js">Actually it DOES, But only in V8 - ie: chrome and node.js</h4>
<p>(as an interesting aside, this technique is used alot in the express source code. Don’t try this at home, unless you do server side node at home of course!)</p>
<p>Sorry to burst your bubble but I must advise you that you do not do this on the browser as it will not work becase <strong>proto</strong> is a protected attribute. Thats right, the song and dance above it using <em>new</em> is the only surefire way to assign the <strong>proto</strong> attribute.</p>
<h3 id="call()_and_apply()">call() and apply()</h3>
<p>To recap</p>
<p>Unless you call the function with new, <em>‘this’</em> becomes resolved within the function to whatever is on the left side of the ‘.’. call() and apply() can be called on any function and allow you to explicitly set what <em>‘this’</em> will resolve to. the only difference is that call takes the arguments of the function right after the new meaning of <em>‘this’</em> and apply takes the arguments as an array.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">myObject1 = { foo: <span class="string">'bar'</span>, num: <span class="number">1</span> }</div><div class="line"></div><div class="line">myObject2 = { foo: <span class="string">'manshu'</span>, getFoo : <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{ <span class="keyword">return</span> <span class="keyword">this</span>.foo; } inc: <span class="function"><span class="keyword">function</span><span class="params">(num)</span> </span>{ <span class="keyword">this</span>.num += num; <span class="keyword">return</span> <span class="keyword">this</span>.num; } }</div><div class="line"></div><div class="line"><span class="comment">//errors out because it doesn't have a getFoo() method myObject1.getFoo();</span></div><div class="line"></div><div class="line">myObject2.getFoo() <span class="comment">// =&gt; 'manshu'</span></div><div class="line"></div><div class="line"><span class="comment">//heres where is gets interesting myObject2.getsFoo.call(myObject1) // =&gt; 'bar'</span></div><div class="line"></div><div class="line"><span class="comment">//this one errors because myObject2 does not have a num attribute myObject2.inc() // badd</span></div><div class="line"></div><div class="line">myObject2.inc.call(myObject1, <span class="number">1</span>); <span class="comment">//sets myObject1.num to 2</span></div><div class="line"></div><div class="line"><span class="comment">//apply does the same with the arguments in an array myObject2.inc.apply(myObject1, [1]); // myObject1.num is now 3!!</span></div></pre></td></tr></table></figure>

<p>Now we’re ready for how to create inheritence chains in javascript! (that article is comming soon.)</p>

        
        <footer class="article-footer">
          <a data-url="http://yoursite.com/2013/03/31/on-this-protototypes-and-dunderheads/" data-id="nd6jnv80vtzk5f5r" data_title="On this, protototypes, and dunderheads"
          data_summary="Of all the stranger than fiction things I have seen, I can’t say I have experienced as blatant a miscarriage of conceptual understanding as I have with javascr..." class="article-share-link">Share</a>
          
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/Javascript-prototypes/">Javascript, prototypes</a>
  </div>


          

        </footer>
      
    </div>
  </div>
</article>


  
    <article id="post-td4d961rpo9ikiqr" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    

    
      <header class="article-header">
        <i class="fa fa-file-text-o"></i>
        
  
    <h1 class="archive-title" itemprop="name">
      <a class="article-title" href="/2013/02/14/quicksort/">Quicksort Algorithm in Javascript</a>
    </h1>
  


        <div class="article-date">
  <time datetime="2013-02-15T02:49:00.000Z" itemprop="datePublished">Feb 14 2013</time>
</div>

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
          <p>Here’s a basic Quicksort algorithm. You can call this code using Node.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Sort = <span class="built_in">require</span>(<span class="string">'./quicksort.js'</span>);</div><div class="line">list = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>,<span class="number">2</span>, <span class="number">5</span>];</div><div class="line"><span class="keyword">var</span> sorted = Sort(list, <span class="function"><span class="keyword">function</span><span class="params">(a, b)</span> </span>{</div><div class="line">	<span class="keyword">if</span> (a &gt; b) {</div><div class="line">		<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">	} <span class="keyword">else</span> <span class="keyword">if</span> (a === b) {</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">	} <span class="keyword">else</span> {</div><div class="line">		<span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">	}</div><div class="line">});</div></pre></td></tr></table></figure>

<p>have fun and hope this proves useful to somebody!</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//quicksort.js</span></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span><span class="params">(list1, compareFunction)</span> </span>{</div><div class="line">    <span class="keyword">var</span> list = list1;</div><div class="line">    <span class="keyword">var</span> cmp = compareFunction;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> swap = <span class="function"><span class="keyword">function</span><span class="params">(i, j)</span> </span>{</div><div class="line">        <span class="comment">/* swaps the indexer A[i] and A[j] */</span></div><div class="line">        <span class="keyword">var</span> _i = list[i];</div><div class="line">        <span class="keyword">var</span> _j = list[j];</div><div class="line">        list[j] = _i;</div><div class="line">        list[i] = _j;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">var</span> partition = <span class="function"><span class="keyword">function</span><span class="params">(p, r)</span> </span>{</div><div class="line">        <span class="comment">/* the partition function goes through the array</span></div><div class="line">         *  list[</div><div class="line">         */</div><div class="line">        <span class="keyword">var</span> r = r;</div><div class="line">        <span class="keyword">var</span> i = p; <span class="comment">//on intiial pass, p is 0</span></div><div class="line"></div><div class="line">        <span class="comment">/* for each entry i where A[i] is less than A[r-1]</span></div><div class="line">         * where r-1 is the index of the Penultimate item</div><div class="line">         */</div><div class="line">        <span class="comment">//from j = 0 to j = r-1</span></div><div class="line">        <span class="comment">//exchange A[i] and A[j] if A[j] &gt; A[r]</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = p; j &lt; r; j++) {</div><div class="line">            <span class="comment">//console.log("lets try this ", list);</span></div><div class="line">            <span class="comment">//console.log("i : " + i + " j : " + j);</span></div><div class="line">            <span class="keyword">if</span> (cmp(list[j],list[r]) &lt;= <span class="number">0</span> ) {</div><div class="line">                <span class="comment">//swap them!! and then increment i</span></div><div class="line">                swap(i, j);</div><div class="line">                i++;</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        swap(i, r);</div><div class="line">        <span class="keyword">return</span> i;</div><div class="line"></div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">var</span> quickSort = <span class="function"><span class="keyword">function</span><span class="params">(p, r)</span> </span>{</div><div class="line">        <span class="keyword">if</span> (p &lt; r) {</div><div class="line">            q = partition(p, r);</div><div class="line">            quickSort(p, q - <span class="number">1</span>);</div><div class="line">            quickSort(q + <span class="number">1</span>, r)</div><div class="line"></div><div class="line">        }</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">var</span> initialize = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">        quickSort(<span class="number">0</span>, list1.length-<span class="number">1</span>);</div><div class="line"></div><div class="line">    }</div><div class="line">    <span class="comment">//compute the sorted value</span></div><div class="line">    initialize();</div><div class="line"></div><div class="line">    <span class="keyword">return</span> list1;</div><div class="line"></div><div class="line">}</div></pre></td></tr></table></figure>


        
        <footer class="article-footer">
          <a data-url="http://yoursite.com/2013/02/14/quicksort/" data-id="td4d961rpo9ikiqr" data_title="Quicksort Algorithm in Javascript"
          data_summary="Here’s a basic Quicksort algorithm. You can call this code using Node.js
1234567891011var Sort = require('./quicksort.js');list = [3, 4, 5,2, 5];var sorted = S..." class="article-share-link">Share</a>
          
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript-algorithms-sorting/">javascript algorithms sorting</a>
  </div>


          

        </footer>
      
    </div>
  </div>
</article>


  
  



</section>
        
          
<aside id="sidebar">
  
    
      <div class="widget-wrap">
    <div id="search-form-wrap">
      <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://yoursite.com"></form>
    </div>
</div>

    
      
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li class="recent-list">
            <a href="/2014/02/08/functional-programming-with-ecmascript6-generators/">Functional programming with ecmascript6 generators</a>
          </li>
        
          <li class="recent-list">
            <a href="/2014/02/01/koa-zero-to-todo-list/">koa: zero to todo list</a>
          </li>
        
          <li class="recent-list">
            <a href="/2014/01/22/javascript-generators-first-impressions/">javascript generators: first impressions</a>
          </li>
        
          <li class="recent-list">
            <a href="/2014/01/06/lets-build-a-backbone-based-framework/">lets build a backbone based framework!!</a>
          </li>
        
          <li class="recent-list">
            <a href="/2013/07/16/lexically-scope-like-a-boss/">How to lexically scope like a boss</a>
          </li>
        
      </ul>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <h3 class="widget-title">Links</h3>
    <div class="widget">
      <ul>
        
         <li class="blogroll">
           
             <i class="fa fa-github"></i>
           
           <a href="https://github.com/" title="Github">Github</a>
          </li>
        
         <li class="blogroll">
           
             <i class="fa fa-google-plus"></i>
           
           <a href="https://plus.google.com/" title="Google+">Google+</a>
          </li>
        
      </ul>
    </div>
  </div>


    
  
</aside>


        
      </div>
      <footer id="footer">
  
  <div class="outer container">
    <div id="footer-info" class="inner">
      <a href="/">Console.blog(this.thought)</a> &copy; 2014 Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/seff/nut" target="_blank">Nut</a>
    </div>
  </div>
</footer>
<a id="gotop" href="#">
  <i class="fa fa-chevron-up"></i>
</a>

    </div>
    <nav id="mobile-nav">
  
    <a href="[object Object]" class="mobile-nav-link">0</a>
  
    <a href="[object Object]" class="mobile-nav-link">1</a>
  
    <a href="[object Object]" class="mobile-nav-link">2</a>
  
    <a href="[object Object]" class="mobile-nav-link">3</a>
  
    <a href="[object Object]" class="mobile-nav-link">4</a>
  
</nav>

    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>

<script src="/js/jquery.fitvids.js" type="text/javascript"></script>

<script src="/js/bootstrap.min.js" type="text/javascript"></script>

<script src="/js/script.js" type="text/javascript"></script>


  </div>
</body>
</html>
